!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f5ecf0cb-a261-3100-aafc-b9b043ae4e2f")}catch(e){}}();
define(["require","exports","./c_api_v2_routes_growth_provider","./e_file_viewer_static_scl_page_file","./e_core_exception","react","./c_src_sink_index","./c_bem","./c_lodash-es_lodash","./c_hive_schemas_sharing-request_access_user_events","./e_edison","./c_pap-events_navigation_select_create_folder_action","./c_init_data_edison","./c_memoize-one","./c_react-use_misc_util","./e_data_modules_stormcrow","./c_chat_chat_constants","./c_api_v2_unauthed_client","./c_spectrum_util_raf_throttle","./c_core_i18n","metaserver/static/js/langpack","./c_core_notify","react-dom","./c_security_csrf_hmac","./c_react_jsx-runtime","./c_watermarking_utils_getImageDefaultSizes"],(function(e,t,i,n,o,a,s,c,r,_,h,l,u,d,C,p,m,g,f,A,w,k,M,P,v,D){"use strict";function I(e){return e.ns("megaphone_chat")}const L=new class{constructor(){this.loadClient=(e,t)=>{if(e){const i=t.chatStoneToProtoModule.chatStoneToProto(e);t.chatClientModule.ChatClientSingleton.setupChatEnvironment(i)}},this.getBestChatCampaignAndLoadChatClient=(e,t,i)=>{const n={url:e};if(i){return I(new t.defaultUserClientModule.DefaultUserApiV2Client(i)).rpc("get_best_chat_campaigns",n,{}).then((e=>this.loadClient(e.props,t)))}return I(new t.noAuthClientModule.NoAuthApiV2Client).rpc("get_best_chat_campaigns",n,{}).then((e=>this.loadClient(e.props,t)))},this.getChatCampaignByIdAndLoadClient=(e,t,i,n)=>{const o={url:e,campaign_id:t,locale:window.navigator.language?window.navigator.language:window.navigator.browserLanguage};if(n){return I(new i.defaultUserClientModule.DefaultUserApiV2Client(n)).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,i)))}return I(new i.noAuthClientModule.NoAuthApiV2Client).rpc("get_chat_campaign_by_id",o,{}).then((e=>this.loadClient(e.props,i)))},this.resumeOrGetBestChatCampaignAndLoadClient=(e,t,i,n)=>e?Promise.resolve(this.loadClient(e,t)):this.getBestChatCampaignAndLoadChatClient(i,t,n),this.getResumedChatCampaignAndLoadClient=(e,t,i,n,o)=>{const a={url:e,legacy_persistence_cookie:t||"",chat_persistence_cookie:i||""};if(o){return I(new n.defaultUserClientModule.DefaultUserApiV2Client(o)).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,n,e,o)))}return I(new n.noAuthClientModule.NoAuthApiV2Client).rpc("get_resumed_chat_campaign",a,{}).then((t=>this.resumeOrGetBestChatCampaignAndLoadClient(t.props,n,e,o)))},this.importDependencies=()=>Promise.all([new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_file"],t,i)})).then((function(e){return e.default_user_client_esnext})),new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_file"],t,i)})).then((function(e){return e.noauth_client_esnext})),new Promise((function(t,i){e(["./c_chat_chat_stone_to_proto"],t,i)})),new Promise((function(t,i){e(["./c_chat_chat_client"],t,i)})).then((function(e){return e.chat_client_esnext})),new Promise((function(t,i){e(["./c_memoize-one"],t,i)})).then((function(e){return e.cookies_esnext})),new Promise((function(t,i){e(["./c_chat_chat_constants"],t,i)})).then((function(e){return e.chat_constants_esnext}))]),this.getCookies=(e,t)=>{const{Cookies:i}=e,{SNAPENGAGE_CHAT_VISIBLE_COOKIE:n,CHAT_CAMPAIGN_VISIBLE_COOKIE:o}=t;return{legacy_persistence_cookie:i.read(n),chat_persistence_cookie:i.read(o)}},this.getCampaignFromChatServiceWithDependencies=([e,t,i,n,o,a],s,c)=>{const r={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:i,chatClientModule:n,cookiesModule:o,chatConstantsModule:a},_=this.getCookies(o,a);return _.legacy_persistence_cookie||_.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,_.legacy_persistence_cookie,_.chat_persistence_cookie,r,c):this.getBestChatCampaignAndLoadChatClient(s,r,c)},this.getChatCampaignIDFromChatServiceWithDependencies=([e,t,i,n,o,a],s,c,r)=>{const _={defaultUserClientModule:e,noAuthClientModule:t,chatStoneToProtoModule:i,chatClientModule:n,cookiesModule:o,chatConstantsModule:a},h=this.getCookies(o,a);return h.legacy_persistence_cookie||h.chat_persistence_cookie?this.getResumedChatCampaignAndLoadClient(s,h.legacy_persistence_cookie,h.chat_persistence_cookie,_,r):this.getChatCampaignByIdAndLoadClient(s,c,_,r)},this.loadChatClientWithBestCampaign=(e,t,i)=>{if(this.loadPromise)return this.loadPromise;const o=i?Promise.resolve():n.waitForTTI({timeoutMS:5e3});return this.loadPromise=o.then((()=>this.importDependencies())).then((i=>this.getCampaignFromChatServiceWithDependencies(i,e,t))),this.loadPromise},this.loadCampaignByID=(e,t,i)=>(this.loadPromise||(this.loadPromise=this.importDependencies().then((n=>this.getChatCampaignIDFromChatServiceWithDependencies(n,e,t,i)))),this.loadPromise)}};t.default=L}));
//# sourceMappingURL=c_chat_chat_client_loader.after-display.js-vflO_jinL.map

//# debugId=f5ecf0cb-a261-3100-aafc-b9b043ae4e2f