!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="fec28e4a-5e39-3343-8dd0-ac4a43d712bb")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_stacks_async_add_to_stack","./e_data_modules_stormcrow","./e_edison","./c_api_v2_routes_growth_provider","./c_api_v2_unauthed_client","./c_pap-events_navigation_select_create_folder_action","./c_memoize-one","./c_bem","./c_src_sink_index","./c_inband-screen_internals_share-modal-share","./c_stacks_lib_api","./c_utils_dsx_dsx-react","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_browse_welcome_hub_lib_types","./c_init_data_edison","./e_core_exception","./c_react-use_misc_util","./c_lodash-es_lodash","./c_spectrum_util_raf_throttle","./c_core_notify","react-dom","./c_chat_chat_constants","./c_security_csrf_hmac","./c_react_jsx-runtime","./c_watermarking_utils_getImageDefaultSizes","metaserver/static/js/langpack","./c_ui_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_ui_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_ui_over-quota-sweep-blocking-modal_use_get_plans","./c_growth-components_over-quota-file-viewer-modal","./c_trial-cards_trial-plan-card","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_react-hookz_web_useRafCallback","./c_upload_kit_lib_types","./c_hive_schemas_sharing-request_access_user_events","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_abuse_fingerprintjs_abuse_fpjs_provider","react/jsx-runtime","./c_fingerprintjs_fpjs-pro-static_fp","./c_fingerprintjs_botd","./c_shared_with_redux_store","./c_browse_shared_with_api","./c_contacts_contact","./c_validators","./c_dig-components_chip_index","./c_dig-components_typeahead_index","./c_common_components_buttons","./c_dig-icons_assets_ui-icon_line_share","./c_ui_share-blocking-wrapper_share_blocking_wrapper","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_dig-icons_assets_ui-icon_line_upsell","./c_ui_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_common_components_layout","./c_content-member-list_internals_content-member-list","./c_dig-icons_assets_ui-icon_line_team","./c_dig-illustrations_spot_bowl-empty","./c_dig-content-icons_icons_folder-shared-default-small","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_fill_stacks","./c_dig-icons_assets_ui-icon_line_upload-file","./c_dig-icons_assets_ui-icon_line_syncing","./c_dig-components_tabs_index","./c_components_icons_icon_dropdown_selected","./c_date-fns__lib_requiredArgs_index","./c_flux_store_listener","./c_ui_modal_dig","./c_form","./c_account_email_verify"],(function(e,t,a,i,r,n,o,s,c,l,d,_,u,f,p,m,g,h,v,E,y,S,b,M,C,w,k,x,I,$,A,T,L,O,D,R,F,P,q,j,N,V,H,U,W,B,Q,G,z,Y,K,Z,X,J,ee,te,ae,ie,re,ne,oe,se,ce,le,de,_e,ue,fe,pe,me,ge,he,ve,Ee,ye,Se,be,Me){"use strict";function Ce(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var i=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var we=Ce(t);a.createApiv2Query({nsClient:p.GetStacksRoutes,rpc:"query_stacks"});const ke=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),xe=(e,t=!0)=>{t?f.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):f.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},Ie=({children:e,onFallback:t,onRequestClose:r})=>{const n=g.useData(),o=we.useRef(!1),s=(()=>{const e=i.useIntl();return we.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return f.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return f.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return f.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return xe(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return xe(e),!0;default:return!1}}),[e])})();return we.useEffect((()=>{if("error"===n.status&&!o.current){o.current=!0;s(n)?r():t()}}),[n,t,r,s]),we.createElement(we.Fragment,null,e)};Ie.displayName="DataLoadingErrorWrapper";const $e=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ae,defaultEmitter:Te}=a.defineLogger((async({event:e,getContextValue:t})=>{const i=t(a.Context$1),r=t(a.Context$2),n=t(a.Context$3),o={...a.getTags$4(i),...a.getTags$5(r),...a.getTags$6(n),isSm24:"true"},s={...a.getProperties$4(i),...a.getProperties$5(r),...a.getProperties$6(n)};e.key===$e&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...s}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:o}))})),Le=({children:e,sessionId:t,onRequestClose:i})=>{var r,n;const o=Ae(),{viewer:s,isLoading:c}=a.useViewer(),l=!c&&!1===(null===(r=s.active_user)||void 0===r?void 0:r.is_email_verified);return we.default.useEffect((()=>{l&&o.select($e).emit({sessionId:t})}),[l,t,o]),l?we.default.createElement(h.VerifyEmailModal,{viewer:s,user:s.active_user,reason:v.EmailVerificationReasons.SHMODAL,email:null===(n=s.active_user)||void 0===n?void 0:n.email,onShowChange:()=>{s.active_user&&h.ChangeEmail.show(s,s.active_user,v.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{h.EmailVerification.get_for_user(s,s.active_user).email_sent(void 0,v.EmailVerificationReasons.SHMODAL,!0),i()},onCancel:i}):we.default.createElement(we.default.Fragment,null,e)};Le.displayName="EmailVerificationWrapper";const Oe=e=>{var t;const a=(e=>m.useInitStore(e,(e=>{const t=m.proxy((()=>e.get().fileOrFolder)),a=m.proxy((()=>e.get().user)),i=m.proxy((()=>e.get().shareModalExtras)),r=m.proxy((()=>{var t;return null===(t=e.get().shareModalExtras)||void 0===t?void 0:t.origin})),n=m.proxy((()=>e.get().actionSurface)),o=m.proxy((()=>e.get().actionElement)),s=m.proxy((()=>e.get().progressiveInbandVariant)),c=m.store(Date.now()),l=m.store(void 0),d=m.store(e.get().isOpen),_=m.proxy((()=>e.get().sessionId)),u=m.proxy((()=>e.get().displayType)),f=m.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),p=m.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$fileOrFolder:t,$user:a,$shareModalExtras:i,$isOpen:d,$origin:r,$actionSurface:n,$actionElement:o,$progressiveInbandVariant:s,$openFlexibleEntryPointTimestamp:c,$dwellFlexibleEntryPointActionTimestamp:l,$sessionId:_,$displayType:u,$anchorRef:f,$overlayPlacement:p,$props:e}})))(e);return we.default.createElement(we.default.Fragment,null,we.default.createElement(f.SharingSdkProvider,{userApiProps:e.user,origin:null===(t=e.shareModalExtras)||void 0===t?void 0:t.origin,actionInfo:{actionSurface:e.actionSurface}},we.default.createElement(De,{store:a})))};Oe.displayName="ShareMe24Browse";const De=({store:e})=>{var t,o,s;const c=m.useStore(e.$fileOrFolder),l=c.is_dir,d=m.useStore(e.$origin),_=m.useStore(e.$actionElement),u=m.useStore(e.$actionSurface),h=m.useStore(e.$sessionId),v=m.useStore(e.$isOpen),y=m.useStore(e.$anchorRef),S=m.useStore(e.$overlayPlacement),b=m.useStore(e.$displayType),M=n.useQueryClient();l&&((e,t)=>{ke.prefetchQuery(e,{apiArg:{path:t,limit:p.STACK_SIZE_LIMIT}})})(M,c.file_id);const C=(e=>we.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),w=(e=>we.default.useCallback((()=>{const{actionSurface:t}=e.$props.get();if("browse_screen"===t||"quick-view-browse"===t||"file_choose"===t){const t=e.$origin.get();a.trackUserLeapEvent(a.SharingUserLeapEvent.SM24_IB_SHARE_COMPLETE,t)}e.$props.get().onInbandShareCompleted(),e.$isOpen.set(!1)}),[e]))(e),k=we.useCallback((async e=>{a.markMilestoneAsCompleted(e,E.ActivationTileMilestoneId.SHARE_CONTENT)}),[]),{onActionClicked:x,user:I}=e.$props.get(),[$,A]=we.default.useState(a.getObjectIdentifier(c));we.default.useEffect((()=>{(async()=>{if(!$.fileId||""===$.fileId){const e=await a.fetchLegacySharingObjectMetadataObjectIdentifier($);A(e)}})()}),[$]);const T=we.default.useMemo((()=>c.is_dir?c.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:a.filename(c.fq_path),size:c.bytes}),[c]),L=we.default.useMemo((()=>({actionSurface:u,actionElement:_,contentAction:"share",tiburonOrigin:d,screen:"share_screen",shareModalType:"sm24"})),[u,_,d]),O=m.useStore(e.$progressiveInbandVariant),D=m.useStore(e.$props).onFallback,{data:R,isLoading:F}=a.useSharingPrefs(),P=null!==(t=null==R?void 0:R.apiData.is_file_transfer_enabled)&&void 0!==t&&t,q=c.is_dir?r.folderEligibleForTransfer(c):!c.is_cloud_doc,j=I.is_team_admin,N=F,V=!!(null===(s=null===(o=a.useDashAccess().data)||void 0===o?void 0:o.apiData.feature_attributes)||void 0===s?void 0:s.has_stacks_in_fss);let H=null,U=we.default.useMemo((()=>l?null:[{file_id:c.file_id,fq_path:c.fq_path}]),[l,c]);const W=((e,t=!1)=>{const a=ke.useQuery({apiArg:{path:e,limit:p.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return we.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const i=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;i.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:i}}}),[a])})(c.file_id,l);W.isLoading||(W.isError?H="too_many_contents"===W.error[".tag"]:(U=W.output,H=!1));const B=a.useShowCopyLinkMiniModalCallback(),Q=we.default.useMemo((()=>"centered"===b?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:y,displayModePositioning:S}),[b,y,S]),G=we.default.useCallback((()=>{var t;const{actionSurface:a,actionElement:i,fileOrFolder:r,user:n,shareModalExtras:o,...s}=e.$props.get();"anchored"===s.displayType&&(null===(t=s.onHoverLocked)||void 0===t||t.call(s,{isOpen:!0}));let c=()=>{};const l=new Promise((e=>{c=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":l});navigator.clipboard.write([e])}else l.then((e=>navigator.clipboard.writeText(e)));const d={write:e=>c(e)},_="undefined"!=typeof window&&window.innerWidth<=800?"bottom":S;k(n);const u="anchored"===s.displayType?{isCenteredDisplayed:!1,anchorRef:s.anchorRef,placement:_,yOffsetDistance:5,onHoverLocked:s.onHoverLocked}:{isCenteredDisplayed:!0};B.fn({user:n,filePath:r.file_id,setIsCreatingSharedLink:()=>{},browseFile:r,zIndexOverride:500,actionSurface:a,actionElement:i,origin:null==o?void 0:o.origin,isFromShareMe24Modal:!0,clipboardWriter:d,withLockedStateModal:!1,userActionSource:null==o?void 0:o.userActionSource,...u})}),[e.$props,S,B,k]),z=we.default.useCallback((()=>{const{user:t,fileOrFolder:a,actionSurface:i,actionElement:n}=e.$props.get(),o=`sm24_${i}_${n}`,s=[a];r.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>r.redirectToCreateTransferWithFiles(s,o),userId:t.id})}),[e]),Y=(e=>we.default.useCallback((t=>{const i=e.$props.get(),r=i.user,n=i.fileOrFolder,o={...i.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};a.asyncShowShareModal(r,n,o)}),[e]))(e),K=(e=>we.default.useCallback((()=>{const t=e.$props.get(),i=t.user,r=t.fileOrFolder,n={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};a.asyncShowShareModal(i,r,n)}),[e]))(e),Z=we.default.useCallback((async()=>{if(!U)return;const e=c.is_dir?a.getFilename(c):void 0;r.asyncAddToStack(i.intl,M,a.CompatNavigate.navigate,U,e)}),[U,c,M]);return we.default.createElement("div",null,we.default.createElement(Le,{sessionId:h,onRequestClose:C},we.default.createElement(f.MetadataProvider,{sharingObjectIdentifier:$,shareModalSessionId:h},we.default.createElement(a.ContextProvider,{context:f.Context,value:h},we.default.createElement(a.ContextProvider,{context:a.Context$1,value:L},we.default.createElement(a.ContextProvider,{context:a.Context$2,value:T},we.default.createElement(g.Provider,{objectIdentifier:$,sessionId:h,objMetadataNewApiVariant:"OFF"},we.default.createElement(Re,{sessionId:h,actionElement:_,actionSurface:u,isDir:l},we.default.createElement(Ie,{onFallback:D,onRequestClose:C},we.default.createElement(g.Main,{...Q,isOpen:v,onRequestClose:C,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:G,transferMode:"controlled_v1",transferHandler:z,settingsMode:"controlled_v1",settingsHandler:Y,manageAccessHandler:K,objectIdentifier:$,progressiveInbandVariant:O,canUserUseTransfer:P,canContentUseTransfer:q,canUserEnableTransfer:j,isTransferEligibilityLoading:N,referrerLoggingMetadata:L,objectLoggingMetadata:T,onActionClicked:x,onInbandShareCompleted:w,fileOrFolder:c,canUserCreateStack:V,isFolderFileCountOverLimit:H,contents:U,createStackHandler:Z}))))))))))};De.displayName="ShareMe24BrowseInternals";const Re=({children:e,sessionId:i,actionElement:r,actionSurface:n,isDir:o})=>{const s=g.useData(),c=we.default.useRef(!1);return t.useEffect((()=>{if(!c.current)return"error"===s.status?(c.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:i,actionElement:r,actionSurface:n,isDir:o})):"loaded"===s.status?(c.current=!0,void a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:i,actionElement:r,actionSurface:n,isDir:o,isSharingBanned:s.accountMetadata.is_sharing_banned})):void 0}),[s.status,i,r,n,o]),t.useEffect((()=>()=>{c.current||(c.current=!0,a.defaultEmitter$1.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:i,actionElement:r,actionSurface:n,isDir:o}))}),[]),we.default.createElement(we.default.Fragment,null,e)};Re.displayName="DataLoadingLogger",e.ShareMe24Browse=Oe}));
//# sourceMappingURL=c_shareme24_browse_integration_index.after-display.js-vflAAWWvz.map

//# debugId=fec28e4a-5e39-3343-8dd0-ac4a43d712bb