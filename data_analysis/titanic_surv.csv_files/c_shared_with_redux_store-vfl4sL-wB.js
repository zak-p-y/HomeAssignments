!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="04798048-d5c2-3596-8f15-af70f2297518")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_file","./c_browse_shared_with_api","./e_data_modules_stormcrow"],(function(e,a,t,r){"use strict";const i={sharedFolderDataByTargetNamespaceId:{},hasSharedDataLoadedByParentPath:{},sharedLinkExistsByFileIdOrPath:{},sharedFileDataByFileId:{},integrationData:void 0},s=e=>a.getStateAtNamespace(e,a.BROWSE_SHARED_WITH_NAMESPACE_KEY)||i;function n(e,a){return["share_ajax:shared_with",e,a.toString()]}const d=e=>a.user(e);let o=null;const l=({parentPath:e,abortCurrentRequest:t=!1})=>(r,i)=>{const s=i();t&&o&&o.abort(),a.isInsideBackupFolder(s)?r(u({parentPath:e})):r(_({parentPath:e}))},u=({parentPath:e})=>(t,r)=>{const i=r(),s=d(i),n=a.mountPoints(i),o={};n&&n.forEach(((e,t)=>o[t]={memberCount:1,joinedMembers:[{...s,access_type:"owner",user_id:s.id,photo_url:s.photo_url,initials:a.getInitials(s.display_name)}]})),t(S.setNamespaceSharedWithData({parentPath:e,sharedFolderData:o}))},_=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedWithData`,(async({parentPath:e},{getState:a})=>{const i=a(),s=d(i);return await r.queryClient.fetchQuery(n(e,5),(async()=>await t.getSharedWithFolderData(s,e,5).then((a=>{const t=(e=>{const a={};for(const t of e)a[t.ns_id]={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members,audienceDescription:t.audience_description,memberCount:t.num_users_and_invites,accessTextData:{total_groups_and_users:t.total_groups_and_users,total_unique_inherited_members:t.total_unique_inherited_members,total_unique_users:t.total_unique_users,users_outside_team:t.users_outside_team,is_confidential:t.is_confidential,isParentTmr:t.is_parent_tmr,is_parent_tsd:t.is_parent_tsd,is_parent_namespace:t.is_parent_namespace,has_team_group:t.has_team_group,has_group:t.has_group}};return a})(a);return{sharedFolderData:t,parentPath:e}})).finally((()=>o=null))))})),c=e=>{switch(e[".tag"]){case"viewer":return"viewer";case"editor":return"editor";case"owner":return"owner";default:return"default"}},h=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedFileDataForFiles`,(async(e,{getState:i,dispatch:s,rejectWithValue:n})=>{const o=i();if(!d(o).is_email_verified)return n("User's email is not verified.");const l=e.slice(0,100),u=e.slice(100),_={},p={},m=await t.getFileMembersCount(r.queryClient,l),y=new Set;Object.values(m).forEach((e=>{e&&e.members.users.forEach((e=>{e&&y.add(e.user.account_id)}))}));return(await a.fetchAccountBatch(Array.from(y))).apiData.forEach((e=>{e&&(p[e.account_id]=e)})),Object.entries(m).forEach((([e,t])=>{t&&(_[e]={memberCount:t.member_count,groups:t.members.groups.map((e=>({access_type:c(e.access_type),gid:e.group.group_id,is_automatic:"team"===e.group.group_type[".tag"],name:e.group.group_name,num_users:e.group.member_count||0}))),invitations:t.members.invitees.map((e=>({access_type:c(e.access_type),email_or_fbname:"email"===e.invitee[".tag"]?e.invitee.email:"",invitation_id:"email"===e.invitee[".tag"]?e.invitee.email:""}))),joinedMembers:t.members.users.map((e=>{var t,r;return{access_type:c(e.access_type),display_name:e.user.display_name,familiar_name:null===(t=p[e.user.account_id])||void 0===t?void 0:t.name.familiar_name,initials:a.getInitials(e.user.display_name),photo_url:null===(r=p[e.user.account_id])||void 0===r?void 0:r.profile_photo_url,user_id:e.user.account_id,email:e.user.email,account_id:e.user.account_id}}))})})),(null==u?void 0:u.length)&&s(h(u)),{sharedFileData:_}})),p=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedLinkExists`,(async(e,{getState:r})=>{const i=r(),s=a.getBrowseState(i).user;if(s)return await t.getSharedLinkExistsForFileIdOrPath(e,s).then((a=>({fileIdOrPath:e,sharedLinkExists:(null==a?void 0:a.length)>0})))})),m=a.createSlice({name:a.BROWSE_SHARED_WITH_NAMESPACE_KEY,initialState:i,reducers:{clear:(e,a)=>i,clearSharedFileDataByFileId:(e,a)=>{e.sharedFileDataByFileId={}},clearSharedLinkExistsCache:(e,a)=>{e.sharedLinkExistsByFileIdOrPath={}},setHasSharedDataLoaded:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=t.isLoaded},setNamespaceSharedWithData:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=!0,e.sharedFolderDataByTargetNamespaceId=t.sharedFolderData}},extraReducers:e=>{e.addCase(_.fulfilled,((e,{payload:a})=>{const t={...e.hasSharedDataLoadedByParentPath};return(null==a?void 0:a.parentPath)?(t[a.parentPath]=!0,{...e,hasSharedDataLoadedByParentPath:t,sharedFolderDataByTargetNamespaceId:a.sharedFolderData}):e})).addCase(h.fulfilled,((e,{payload:a})=>({...e,sharedFileDataByFileId:{...e.sharedFileDataByFileId,...a.sharedFileData}}))).addCase(p.fulfilled,((e,a)=>{a.payload&&(e.sharedLinkExistsByFileIdOrPath[a.payload.fileIdOrPath]=a.payload.sharedLinkExists)}))}}),{reducer:y}=m,S=m.actions;let f;e.filesChanged=e=>(t,i)=>{const d=i();e===a.path(d)&&(t(S.clearSharedLinkExistsCache(null)),t(p(e)),r.queryClient.invalidateQueries(n(e,5)),t(l({parentPath:e})),t(S.clearSharedFileDataByFileId(null)),t(((e,t)=>{const r=t(),i=s(r),n=a.sortedFiles(r).reduce(((e,a)=>((e=>!(e.is_dir||e.isDeleted))(a)&&!(a.file_id in i.sharedFileDataByFileId)&&e.push(a.file_id),e)),[]);e(h(n))})))},e.getSharedWithState=s,e.getStoreForSharedWith=()=>(f||(f=a.getStoreAndRegisterReducers({[a.BROWSE_SHARED_WITH_NAMESPACE_KEY]:y})),a.getStoreForBrowse(),f),e.sharedFileDataOutOfDate=e=>a=>{a(h(e))},e.sharedFolderDataOutOfDate=e=>(t,i)=>{if(!e){const t=i();e=a.path(t)}r.queryClient.invalidateQueries(n(e,5)),t(l({parentPath:e}))},e.sharedLinkDataOutOfDate=e=>a=>{e&&a(p(e))}}));
//# sourceMappingURL=c_shared_with_redux_store.js-vflv9vXiS.map

//# debugId=04798048-d5c2-3596-8f15-af70f2297518