!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="28d06204-625f-3faf-abb4-0e69aaac3e86")}catch(e){}}();
define(["require","exports","./c_pap-events_navigation_select_create_folder_action","./c_bem","./c_api_v2_routes_growth_provider","./c_init_data_edison","./e_core_exception","./c_memoize-one"],(function(e,t,r,s,n,i,a,o){"use strict";window.BUNDLE_GENERATOR="rollup";class c extends n.Message{constructor(e){super(),this.originalUrl="",this.currentUrl="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new c).fromBinary(e,t)}static fromJson(e,t){return(new c).fromJson(e,t)}static fromJsonString(e,t){return(new c).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(c,e,t)}}var d,l;function m(){const e=window.performance?window.performance.now():0;return Math.floor(e)}function h(){const e={};return"number"==typeof window.EDISON_METRICS_JS_EXECUTION_START&&(e[d.JsExecutionStart]=window.EDISON_METRICS_JS_EXECUTION_START),"number"==typeof window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME&&(e[d.RequireLoadCallbackTime]=window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME),"number"==typeof window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME&&(e[d.InitPageModuleLoadTime]=window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME),"number"==typeof window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME&&(e[d.PreloadModulesLoadTime]=window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME),e}c.runtime=n.proto3,c.typeName="edison.prefetch.PrefetchArgs",c.fields=n.proto3.util.newFieldList((()=>[{no:10,name:"original_url",kind:"scalar",T:9},{no:11,name:"current_url",kind:"scalar",T:9}])),function(e){e.JsExecutionStart="js_execution_start",e.RequireLoadCallbackTime="require_load_callback_time",e.InitPageModuleLoadTime="init_page_module_load_time",e.PreloadModulesLoadTime="preload_modules_load_time",e.InitReceived="init_received",e.RenderStarted="render_started",e.RenderComplete="render_complete",e.FirstCssPreloadReceived="first_css_preload_received",e.LastCssPreloadReceived="last_css_preload_received",e.ServerSidePrefetchStartedReceived="server_side_prefetch_started_received",e.DoneStreamingReceived="done_streaming_received",e.StreamedPrefetchWaitTime="streamed_prefetch_wait_time"}(d||(d={})),function(e){e.PageLoadComplete="page_load_complete",e.ErrorPageShown="error_page_shown"}(l||(l={}));class u{constructor(e){this.AMP_NAMESPACE="web_timing",this.marked={};const{atlasservlet:t,pageName:r,performanceNow:s=m,getLazyMetricsReporter:n}=e;this.atlasservlet=t,this.pageName=r,this.performanceNow=s,this.lazyMetricsReporter=n?n():null;let i=()=>{};this.renderCompletePromise=new Promise((e=>{i=e})),this.renderCompleteResolveFn=i,this.eventTimings={},this.streamedPrefetchRequestTimingQueues={},this.streamedPrefetchResponseTimings={}}recordEventTime(e){this.eventTimings[e]=this.performanceNow()}recordEventTimeOnce(e){this.eventTimings[e]||this.recordEventTime(e)}getTags(e){return{atlasservlet:this.atlasservlet,edison_page_name:this.pageName,...e}}recordInitReceived(){this.recordEventTimeOnce(d.InitReceived)}recordRenderStarted(){this.recordEventTimeOnce(d.RenderStarted)}recordRenderComplete(){this.recordEventTimeOnce(d.RenderComplete),this.renderCompleteResolveFn()}recordCssPreloadReceived(){this.recordEventTimeOnce(d.FirstCssPreloadReceived),this.recordEventTime(d.LastCssPreloadReceived)}recordServerSidePrefetchStartedReceived(){this.recordEventTimeOnce(d.ServerSidePrefetchStartedReceived)}recordDoneStreamingReceived(){this.recordEventTimeOnce(d.DoneStreamingReceived)}async saveEventTimings(){if(!this.lazyMetricsReporter)return;await this.renderCompletePromise;const e=await this.lazyMetricsReporter,t={...h(),...this.eventTimings};for(const[r,n]of Object.entries(t)){const t=this.getTags();e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${r}`},t).recordDuration(n,s.TimeUnit.MILLISECONDS)}}async recordStreamedPrefetchRequestTime(e,t){this.streamedPrefetchRequestTimingQueues[e]||(this.streamedPrefetchRequestTimingQueues[e]=[]),this.streamedPrefetchRequestTimingQueues[e].push({loggingIdentifier:t,requestTime:this.performanceNow(),processed:!1}),await this.flushPrefetchTimingRecordQueue()}async recordStreamedPrefetchResponseTime(e,t){this.streamedPrefetchResponseTimings[e]||(this.streamedPrefetchResponseTimings[e]={responseTime:this.performanceNow(),failed:t},await this.flushPrefetchTimingRecordQueue())}markPageLoadSuccess(){this.recordPageMarker(l.PageLoadComplete,{result:"success"})}markPageLoadFailed(){this.recordPageMarker(l.PageLoadComplete,{result:"error"})}markErrorPageShown(){const e=!!this.marked[l.PageLoadComplete];e||this.markPageLoadFailed(),this.recordPageMarker(l.ErrorPageShown,{page_load_completed:e.toString()})}async recordPageMarker(e,t={}){try{const r=await this.lazyMetricsReporter;if(this.marked[e])return;const n=null==r?void 0:r.createCounter({ns:this.AMP_NAMESPACE,name:`edison/page/${e}`},this.getTags({browser:s.getBrowserShortName(),source:s.is_mobile_or_tablet()?"mobile":"web",...t}));null==n||n.increment(),null==n||n.record(),this.marked[e]=!0}catch{console.error("Fail to record page event: ",e)}}async flushPrefetchTimingRecordQueue(){if(!this.lazyMetricsReporter)return;const e=await this.lazyMetricsReporter,t={};for(const[r,n]of Object.entries(this.streamedPrefetchRequestTimingQueues)){const i=this.streamedPrefetchResponseTimings[r];if(i)for(const r of n){const{loggingIdentifier:n,requestTime:a}=r,{responseTime:o,failed:c}=i;if(t[n]||(t[n]=0),t[n]++,r.processed)continue;const l=`${n}_${t[n]}`,m=this.getTags({prefetch_id:l,failed:`${c}`}),h=e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${d.StreamedPrefetchWaitTime}`},m),u=Math.max(o-a,0);if(h.recordDuration(u,s.TimeUnit.MILLISECONDS),r.processed=!0,window.performance)try{window.performance.measure(`edison:${d.StreamedPrefetchWaitTime}:${n}`,{start:0,end:o,detail:{prefetchId:l}})}catch(e){}}}}}class f extends n.Message{constructor(e){super(),this.type={case:void 0},n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new f).fromBinary(e,t)}static fromJson(e,t){return(new f).fromJson(e,t)}static fromJsonString(e,t){return(new f).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(f,e,t)}}f.runtime=n.proto3,f.typeName="edison.prefetch.Prefetch",f.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"pending",kind:"message",T:g,oneof:"type"},{no:2,name:"result",kind:"message",T:p,oneof:"type"}]));class g extends n.Message{constructor(e){super(),this.requestKeys=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new g).fromBinary(e,t)}static fromJson(e,t){return(new g).fromJson(e,t)}static fromJsonString(e,t){return(new g).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(g,e,t)}}g.runtime=n.proto3,g.typeName="edison.prefetch.Prefetch.Pending",g.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"request_keys",kind:"scalar",T:9,repeated:!0}]));class p extends n.Message{constructor(e){super(),this.requestKey="",this.response=new Uint8Array(0),this.error="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new p).fromBinary(e,t)}static fromJson(e,t){return(new p).fromJson(e,t)}static fromJsonString(e,t){return(new p).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(p,e,t)}}p.runtime=n.proto3,p.typeName="edison.prefetch.Prefetch.Result",p.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"request_key",kind:"scalar",T:9},{no:2,name:"response",kind:"scalar",T:12},{no:3,name:"error",kind:"scalar",T:9}]));const P={typeName:"edison.prefetch.PrefetchService",methods:{streamPrefetches:{name:"StreamPrefetches",I:c,O:f,kind:i.MethodKind.ServerStreaming}}};class S extends n.Message{constructor(e){super(),this.isFromOfficeIp=!1,n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new S).fromBinary(e,t)}static fromJson(e,t){return(new S).fromJson(e,t)}static fromJsonString(e,t){return(new S).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(S,e,t)}}S.runtime=n.proto3,S.typeName="edison_dws2.PrefetchArguments",S.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"is_from_office_ip",kind:"scalar",T:8},{no:2,name:"proto_arguments",kind:"message",T:n.Any}]));class _ extends n.Message{constructor(e){super(),this.rpcProxyUrl="",this.atlasservlet="",this.pageName="",this.pageLifecycle="",this.activeUserId=n.protoInt64.zero,this.activeTeamId=n.protoInt64.zero,this.authRole=0,this.authActionType=0,this.uriPath="",this.legacyController="",this.legacyAction="",this.isOfficeIp=!1,this.staticRepoRev="",this.dws2RepoRev="",this.streamingEnabled=!1,this.isBuildTimePrefetchesEnabled=!1,this.isCssPreloadEnabled=!1,this.isReactNextEnabled=!1,this.entryPointModuleName="",this.isDws2Stage=!1,this.originalUrl="",this.originalReferer="",this.prefetchVersion=0,this.isProd=!1,this.gates={},this.browserId="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new _).fromBinary(e,t)}static fromJson(e,t){return(new _).fromJson(e,t)}static fromJsonString(e,t){return(new _).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(_,e,t)}}_.runtime=n.proto3,_.typeName="edison_dws2.EdisonInitParams",_.fields=n.proto3.util.newFieldList((()=>[{no:22,name:"rpc_proxy_url",kind:"scalar",T:9},{no:2,name:"atlasservlet",kind:"scalar",T:9},{no:3,name:"page_name",kind:"scalar",T:9},{no:15,name:"page_lifecycle",kind:"scalar",T:9},{no:4,name:"active_user_id",kind:"scalar",T:4},{no:5,name:"active_team_id",kind:"scalar",T:4},{no:31,name:"auth_role",kind:"scalar",T:13},{no:32,name:"auth_action_type",kind:"scalar",T:13},{no:6,name:"uri_path",kind:"scalar",T:9},{no:9,name:"legacy_controller",kind:"scalar",T:9},{no:10,name:"legacy_action",kind:"scalar",T:9},{no:11,name:"is_office_ip",kind:"scalar",T:8},{no:12,name:"static_repo_rev",kind:"scalar",T:9},{no:13,name:"dws2_repo_rev",kind:"scalar",T:9},{no:14,name:"streaming_enabled",kind:"scalar",T:8},{no:30,name:"is_build_time_prefetches_enabled",kind:"scalar",T:8},{no:36,name:"is_css_preload_enabled",kind:"scalar",T:8},{no:39,name:"is_react_next_enabled",kind:"scalar",T:8},{no:25,name:"entry_point_module_name",kind:"scalar",T:9},{no:27,name:"is_dws2_stage",kind:"scalar",T:8},{no:28,name:"original_url",kind:"scalar",T:9},{no:29,name:"original_referer",kind:"scalar",T:9},{no:33,name:"prefetchVersion",kind:"scalar",T:5},{no:34,name:"is_prod",kind:"scalar",T:8},{no:35,name:"gates",kind:"map",K:9,V:{kind:"scalar",T:8}},{no:38,name:"browserId",kind:"scalar",T:9}]));class y extends n.Message{constructor(e){super(),this.type={case:void 0},this.b64RequestKey="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new y).fromBinary(e,t)}static fromJson(e,t){return(new y).fromJson(e,t)}static fromJsonString(e,t){return(new y).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(y,e,t)}}y.runtime=n.proto3,y.typeName="edison_dws2.EdisonRequest",y.fields=n.proto3.util.newFieldList((()=>[{no:2,name:"service_method_prefetch",kind:"message",T:w,oneof:"type"},{no:3,name:"css_preload",kind:"message",T:E,oneof:"type"},{no:5,name:"module_preload",kind:"message",T:T,oneof:"type"},{no:4,name:"b64_request_key",kind:"scalar",T:9}]));class w extends n.Message{constructor(e){super(),this.service="",this.method="",this.initialPageAtlasservlet="",this.initialPageName="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new w).fromBinary(e,t)}static fromJson(e,t){return(new w).fromJson(e,t)}static fromJsonString(e,t){return(new w).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(w,e,t)}}w.runtime=n.proto3,w.typeName="edison_dws2.EdisonRequest.ServiceMethodPrefetch",w.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"service",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"proto_arguments",kind:"message",T:n.Any},{no:5,name:"initial_page_atlasservlet",kind:"scalar",T:9},{no:6,name:"initial_page_name",kind:"scalar",T:9}]));class E extends n.Message{constructor(e){super(),this.cssPaths=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new E).fromBinary(e,t)}static fromJson(e,t){return(new E).fromJson(e,t)}static fromJsonString(e,t){return(new E).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(E,e,t)}}E.runtime=n.proto3,E.typeName="edison_dws2.EdisonRequest.CssPreload",E.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"css_paths",kind:"scalar",T:9,repeated:!0}]));class T extends n.Message{constructor(e){super(),this.modulePaths=[],n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new T).fromBinary(e,t)}static fromJson(e,t){return(new T).fromJson(e,t)}static fromJsonString(e,t){return(new T).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(T,e,t)}}T.runtime=n.proto3,T.typeName="edison_dws2.EdisonRequest.ModulePreload",T.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"module_paths",kind:"scalar",T:9,repeated:!0}]));class v extends n.Message{constructor(e){super(),this.encodedProto="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new v).fromBinary(e,t)}static fromJson(e,t){return(new v).fromJson(e,t)}static fromJsonString(e,t){return(new v).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(v,e,t)}}v.runtime=n.proto3,v.typeName="edison_dws2.InitProps",v.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"encodedProto",kind:"scalar",T:9}]));class R{constructor(){this.pendingPrefetches={},this.metadataCache={},this.resultsCache={}}async get(e,t){if(this.isReady(e))return this.resultsCache[e].getter();if(!this.pendingPrefetches[e]){let r=()=>{};const s=new Promise((e=>{r=e}));this.pendingPrefetches[e]={promise:s,resolve:r},t&&(this.metadataCache[e]=t)}return await this.pendingPrefetches[e].promise,this.resultsCache[e].getter()}getMetadata(e){if(!this.metadataCache[e])throw new Error("Metadata does not exist for key");return this.metadataCache[e]}has(e){return!!this.pendingPrefetches[e]||!!this.resultsCache[e]}set(e,t){this.pendingPrefetches[e]&&(this.pendingPrefetches[e].resolve(),delete this.pendingPrefetches[e]),this.resultsCache[e]={getter:t}}delete(e){delete this.pendingPrefetches[e],delete this.metadataCache[e],delete this.resultsCache[e]}clear(){this.pendingPrefetches={},this.metadataCache={},this.resultsCache={}}listAllKeys(){return Array.from(new Set([...this.listPendingKeys(),...this.listCachedKeys()]))}listCachedKeys(){return Object.keys(this.resultsCache)}listPendingKeys(){return Object.keys(this.pendingPrefetches)}isPending(e){return!this.isReady(e)&&!!this.pendingPrefetches[e]}isReady(e){return!!this.resultsCache[e]}}class C extends Error{}var A;function k(){if("undefined"==typeof jest&&!n.isServerSide())return async()=>{const{getMetricsReporter:t}=await new Promise((function(t,r){e(["./c_src_sink_index"],t,r)})).then((function(e){return e.index_esnext}));return t()}}t.EdisonPrefetchStatus=void 0,(A=t.EdisonPrefetchStatus||(t.EdisonPrefetchStatus={}))[A.PendingStreaming=0]="PendingStreaming",A[A.PendingAjax=1]="PendingAjax",A[A.StreamedAndNotConsumed=2]="StreamedAndNotConsumed",A[A.StreamedAndConsumed=3]="StreamedAndConsumed",A[A.FetchedByAjax=4]="FetchedByAjax";class M{setEntryInPrefetchLog(e,t,r,s){for(const n of this.prefetchLog)if(n.requestKey===e&&n.status===t)return n.status=r,void(s&&Object.assign(n,s))}constructor(){this.isDoneStreaming=!1,this.isServerSidePrefetchStarted=!1,this.streamingEnabled=!0,this.buildTimePrefetchesEnabled=!1,this.cssPreloadEnabled=!1,this.reactNextEnabled=!1,this.consumedPrefetches={},this.prefetchCacheMgr=new R,this.pendingServerSidePrefetchKeys=[],this.prefetchLog=[],this.metrics=new u({atlasservlet:n.getAtlasservlet(),pageName:n.getPageName(),getLazyMetricsReporter:k()}),this.metrics.recordInitReceived()}static getSingleton(){return M.instance||(M.instance=new M),M.instance}static reset(){M.instance=null}static setIsStreamingEnabled(e){M.getSingleton().streamingEnabled=e}static setIsBuildTimePrefetchesEnabled(e){M.getSingleton().buildTimePrefetchesEnabled=e}static getIsBuildTimePrefetchesEnabled(){return M.getSingleton().buildTimePrefetchesEnabled}static setIsCSSPreloadEnabled(e){M.getSingleton().cssPreloadEnabled=e}static getIsCSSPreloadEnabled(){return M.getSingleton().cssPreloadEnabled}static setIsReactNextEnabled(e){M.getSingleton().reactNextEnabled=e}static getIsReactNextEnabled(){return M.getSingleton().reactNextEnabled}static getPrefetchLog(){return[...M.getSingleton().prefetchLog]}static getMetrics(){return M.getSingleton().metrics}static getStaticRevision(){return n.getRepoRev()}static async _grpcWebAjax(e,s,a,o,c){r.incrementAjaxCount();try{const r=i.createEdisonGrpcWebTransport(),{message:d}=await r.unary({typeName:s},{name:a,I:o.getType(),O:c},void 0,void 0,void 0,o);return M.getSingleton().setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingAjax,t.EdisonPrefetchStatus.FetchedByAjax,{failed:!1,result:n.protoBase64.enc(d.toBinary())}),d}finally{r.decrementAjaxCount()}}static async _prefetch(e,r,s,i){const a=M.getSingleton(),o=new y({type:{case:"serviceMethodPrefetch",value:{service:e,method:r,protoArguments:n.wrapInAny(s),initialPageAtlasservlet:n.getAtlasservlet(),initialPageName:n.getPageName()}}}),c=`${e}.${r}`;if(o.b64RequestKey)throw new Error("The EdisonRequest proto message parameter to prefetchHelper must not have a b64PrefetchKey set (it is computed here so we make sure it is the same between browser and streaming reactserver).");const d=n.marshalProto(o),l=a.prefetchCacheMgr.has(d);if(!n.isServedByEdisonWebServer()||!a.streamingEnabled||a.consumedPrefetches[d]||a.isServerSidePrefetchStarted&&!a.pendingServerSidePrefetchKeys.includes(d)&&!l||a.isDoneStreaming&&!l)return a.prefetchLog.push({edisonRequest:o,requestKey:d,status:t.EdisonPrefetchStatus.PendingAjax,isAjax:!0,isAfterStreaming:a.isDoneStreaming}),M._grpcWebAjax(d,e,r,s,i);l?a.setEntryInPrefetchLog(d,t.EdisonPrefetchStatus.StreamedAndNotConsumed,t.EdisonPrefetchStatus.StreamedAndConsumed):a.prefetchLog.push({edisonRequest:o,requestKey:d,status:t.EdisonPrefetchStatus.PendingStreaming}),a.metrics.recordStreamedPrefetchRequestTime(d,c),a.consumedPrefetches[d]=!0;const m=await a.prefetchCacheMgr.get(d,{service:e,method:r,outputType:i,input:s});return"string"==typeof m?n.unmarshalProto(m,i):m}static async fetch(e,t,r){if(n.isServerSide())return new Promise((()=>{}));const s=e.methods[(i=t,i.charAt(0).toLowerCase()+i.slice(1))].O;var i;const a=n.getRequestOriginalUrl(),o=new c({originalUrl:a,currentUrl:a,...r||{}});return await this._prefetch(e.typeName,t,o,s)}static preloadJSModules(e){if(n.isServerSide()){const t=new y({type:{case:"modulePreload",value:{modulePaths:e}}}),r=n.marshalProto(t);window.ReactserverEdisonClient.sendEdisonRequest(r)}}static resetPendingPrefetches(){const e=M.getSingleton();e.prefetchCacheMgr.listAllKeys().filter((t=>!e.consumedPrefetches[t])).forEach((r=>{e.consumedPrefetches[r]=!0,e.prefetchCacheMgr.delete(r),e.setEntryInPrefetchLog(r,t.EdisonPrefetchStatus.StreamedAndNotConsumed,t.EdisonPrefetchStatus.StreamedAndConsumed)}))}static registerStreamedPrefetch(e,r,s=!1){const i=M.getSingleton();if(i.isDoneStreaming)throw new Error("Cannot register new streamed prefetch after marking that we are done streaming.");if(i.metrics.recordStreamedPrefetchResponseTime(e,s),i.prefetchCacheMgr.has(e))i.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.StreamedAndConsumed,{result:r,failed:s,isAjax:!1,isAfterStreaming:!1});else{const a=n.unmarshalProto(e,y),o={requestKey:e,status:t.EdisonPrefetchStatus.StreamedAndNotConsumed,failed:s,result:r,isAjax:!1,isAfterStreaming:!1,edisonRequest:a};i.prefetchLog.push(o)}i.prefetchCacheMgr.set(e,(()=>{if(s)throw new C(r);return r}))}static markServerSidePrefetchStarted(e){if(!Array.isArray(e))throw new Error("requestKeys must be an array");const r=M.getSingleton();r.isServerSidePrefetchStarted=!0,r.pendingServerSidePrefetchKeys=e,r.metrics.recordServerSidePrefetchStartedReceived();r.prefetchCacheMgr.listPendingKeys().filter((t=>!e.includes(t))).forEach((async e=>{r.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax),M.performGrpcWebAjaxForPendingRequest(e)}))}static doneStreaming(){const e=M.getSingleton();e.isDoneStreaming||(e.metrics.recordDoneStreamingReceived(),e.metrics.saveEventTimings(),e.prefetchCacheMgr.listPendingKeys().forEach((async r=>{e.setEntryInPrefetchLog(r,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax,{isAjax:!0,isAfterStreaming:!0}),M.performGrpcWebAjaxForPendingRequest(r)})),e.pendingServerSidePrefetchKeys=[],e.isDoneStreaming=!0)}static getPrefetchCounts(){return M.getSingleton().prefetchLog.reduce(((e,{isAjax:t,isAfterStreaming:r})=>("boolean"==typeof t&&"boolean"==typeof r&&(r?e.numPrefetchesRequestedAfterDoneStreaming++:e.numPrefetchesRequestedBeforeDoneStreaming++,t?e.numPrefetchesByAjax++:e.numPrefetchesStreamed++),e)),{numPrefetchesRequestedAfterDoneStreaming:0,numPrefetchesRequestedBeforeDoneStreaming:0,numPrefetchesByAjax:0,numPrefetchesStreamed:0})}static async loadPrefetches(){const e=i.createEdisonGRPCWebPromiseClient(P,"/dws2/rpc/"),t=n.getRequestOriginalUrl(),r=new c({originalUrl:t,currentUrl:t}),s=new Set;try{for await(const t of e.streamPrefetches(r))if("pending"===t.type.case&&(M.markServerSidePrefetchStarted(t.type.value.requestKeys),t.type.value.requestKeys.forEach((e=>s.add(e)))),"result"===t.type.case){const{requestKey:e,response:r,error:i}=t.type.value;s.delete(e),i?M.registerStreamedPrefetch(e,i,!0):M.registerStreamedPrefetch(e,n.protoBase64.enc(r),!1)}}catch(e){s.forEach((t=>{M.registerStreamedPrefetch(t,e.toString(),!0)}))}finally{M.doneStreaming()}}static async performGrpcWebAjaxForPendingRequest(e){const t=M.getSingleton();if(!t.prefetchCacheMgr.has(e))throw new Error("Input request key does not match any pending prefetch request");try{const{service:r,method:s,input:n,outputType:i}=t.prefetchCacheMgr.getMetadata(e),a=await M._grpcWebAjax(e,r,s,n,i);t.prefetchCacheMgr.set(e,(()=>a))}catch(r){t.prefetchCacheMgr.set(e,(()=>{throw r}))}}}M.instance=null;const b="edisonLoadCallbacks"in window&&Array.isArray(window.edisonLoadCallbacks)?[...window.edisonLoadCallbacks]:[];window.edisonLoadCallbacks={push:e=>{e(M)}},b.forEach(window.edisonLoadCallbacks.push);var I=Object.freeze({__proto__:null,Edison:M,get EdisonPrefetchStatus(){return t.EdisonPrefetchStatus},PrefetchError:C});t.Edison=M,t.EdisonInitParams=_,t.InitProps=v,t.PrefetchArgs=c,t.PrefetchError=C,t.edison_esnext=I}));
//# sourceMappingURL=e_edison.js-vfl_-XJ_z.map

//# debugId=28d06204-625f-3faf-abb4-0e69aaac3e86