!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8d818073-aebc-3ecb-984f-836c6fe95ddf")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_extensions_open_button_utils","./c_core_i18n","./c_ui_sprite","./c_bem","./c_dig-icons_assets_ui-icon_line_sidebar-show-right","./c_dig-icons_assets_ui-icon_line_print","./c_dig-icons_assets_ui-icon_line_admin-console","./c_cloud_docs_open_with_utils","./c_api_v2_routes_growth_provider","./e_core_exception","./c_src_sink_index","./c_lodash-es_lodash","./c_hive_schemas_sharing-request_access_user_events","./e_edison","./c_pap-events_navigation_select_create_folder_action","./c_init_data_edison","./c_memoize-one","./c_react-use_misc_util","./e_data_modules_stormcrow","./c_chat_chat_constants","./c_api_v2_unauthed_client","./c_spectrum_util_raf_throttle","./c_core_notify","react-dom","./c_security_csrf_hmac","./c_react_jsx-runtime","./c_watermarking_utils_getImageDefaultSizes","./c_spectrum_modal_utility_modal","./c_spectrum_button","./c_spectrum_tertiary_link","./c_icon_templates_actionable_index","./c_spectrum_svg_icon_bundle","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_ui_image","./c_dig-icons_assets_ui-icon_line_pdf","metaserver/static/js/langpack"],(function(e,t,n,i,o,s,r,c,a,l,p,u,d,_,m,f,A,h,O,I,g,y,E,w,x,v,C,S,k,b,F,U,D,M,B,L,T,N,H,W){"use strict";function V(e){return e&&e.__esModule?e:{default:e}}var R=V(t);class P extends R.default.Component{constructor(e){super(e),this.handleMouseOver=()=>{clearTimeout(this.timer),this.timer=setTimeout((()=>{this.props.bylines&&(this.setState({show:!0}),this.props.onDidShow())}),this.props.delay)},this.handleMouseOut=()=>{this.setState({show:!1}),clearTimeout(this.timer)},this.triggerRef=R.default.createRef(),this.state={show:!1}}componentWillUnmount(){clearTimeout(this.timer)}render(){const{children:e,bylines:t,isInActionBar:i}=this.props,o=R.default.Children.only(e);return t?R.default.createElement(R.default.Fragment,null,R.default.createElement(n.Tooltip.Control,{triggerRef:this.triggerRef,open:this.state.show,placement:i?"right":"left"},(e=>{if(e)return e.length>1?R.default.createElement("ul",{className:"extensions-byline-list"},e.map((e=>R.default.createElement("li",{key:e,className:"extensions-byline-list-item"},e)))):R.default.createElement("div",{className:"extensions-byline"},e[0])})(t)),R.default.cloneElement(o,{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,ref:this.triggerRef})):o}}P.defaultProps={delay:500},P.displayName="ExtensionsBylineTooltip";class q extends R.default.Component{render(){const{unityOptions:e,legacyCloudEditorOptions:t,cloudEditorAppActions:o,bylines:a,currentSession:l,previewOption:p,openInReplayOption:u,openInDesktopOption:d,isInActionBar:_,goToFolderOption:m,wrapValuesForActionBar:f,openInNewTabOption:A,openInQuickViewOption:h}=this.props,O=e=>f?i.toActionBarValue(e):e,I=t.map((e=>{const{type:t}=e,i=t===n.OpenButtonAction.OPEN_WITH_CLOUD_DOC?"cloud_doc":"wopi";return R.default.createElement(n.Menu.ActionItem,{key:e.text,value:O(e),withLeftAccessory:e.spriteName?R.default.createElement(s.Sprite,{group:"web",name:e.spriteName,alt:""}):R.default.createElement("img",{alt:"",src:e.iconUrl,width:24,height:24})},R.default.createElement(P,{isInActionBar:_,bylines:a[i],onDidShow:n.handleShowByline(i,l),key:e.text},R.default.createElement("span",null,e.text)))})),g=e.map((e=>R.default.createElement(n.Menu.ActionItem,{key:e.text,value:O(e),withLeftAccessory:function(e){return"ow_desktop"===e.spriteName&&e.type===n.OpenButtonAction.UNITY_FILE?-1!==e.text.indexOf("Dropbox")?R.default.createElement(n.UIIcon,{src:n.DropboxLine}):R.default.createElement(n.UIIcon,{src:n.OpenLine}):R.default.createElement(s.Sprite,{group:"web",name:e.spriteName||"",alt:""})}(e)},e.text)));let y=!1;const E=o.map((e=>{y||(y=i.isWopiAction(e.appAction));const t=e.appAction.handler.editor_name;return R.default.createElement(n.Menu.ActionItem,{key:e.appAction.description,value:O(e),withLeftAccessory:R.default.createElement("img",{alt:"",src:e.appAction.icon.url,width:24,height:24})},R.default.createElement(P,{isInActionBar:_,bylines:a[t],onDidShow:n.handleShowByline(t,l),key:e.appAction.description},R.default.createElement("span",null,e.appAction.description)))})),w=p&&R.default.createElement(n.Menu.ActionItem,{key:p.text,value:O(p),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.ShowLine})},p.text),x=u&&R.default.createElement(n.Menu.ActionItem,{key:u.text,value:O(u),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.DropboxReplayLine})},u.text),v=d&&R.default.createElement(n.Menu.ActionItem,{key:d.text,value:O(d),withLeftAccessory:R.default.createElement(n.UIIcon,{src:r.mac?n.FinderLine:n.FileExplorerLine})},d.text),C=A&&R.default.createElement(n.Menu.ActionItem,{key:A.text,value:O(A),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.GlobeLine})},A.text),S=m&&R.default.createElement(n.Menu.ActionItem,{key:m.text,value:O(m),withLeftAccessory:R.default.createElement(n.UIIcon,{src:c.FolderShowLine})},m.text),k=h&&R.default.createElement(n.Menu.ActionItem,{key:h.text,value:O(h),withLeftAccessory:R.default.createElement(n.UIIcon,{src:c.SidebarShowRightLine})},h.text),b=g.length>0||I.length>0||E.length>0||!!C||!!w||!!x||!!v||!!S||!!k;return y?b&&R.default.createElement(n.Menu.Segment,{key:"open-options"},E,C,S,g,I,w,k,x,v):b&&R.default.createElement(n.Menu.Segment,{key:"open-options"},C,S,g,I,E,w,k,x,v)}}q.displayName="UnityAndCloudEditorsComponent";const K=n.requireCssWithComponent(q,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css","/static/metaserver/static/css/dig-components/index.web-vflD1hFtb.css"]);class Q extends R.default.Component{constructor(e){super(e),this.createAppActionClickHandler=e=>()=>{var t,o;const{file:s,user:r,featureFlags:c,telemetryContext:a,isOfficeOnlineDecoupledFromCloudDocs:l}=this.props;if(i.redirectToActionOrShowAuth(r,[s],e,c,a,void 0,l),"redirect"===e.handler[".tag"]){const t=n.getAppActionExtras(e);n.logEvent$1(this.props.currentSession,"select_action",{menu_version:2,...t})}else if("cloud_editor"===e.handler[".tag"]){const t={};i.isWopiAction(e)?(t.type=n.OpenButtonAction.OPEN_WITH,t.userAction=n.OpenInUserAction.OpenInOfficeOnline):t.type=n.OpenButtonAction.OPEN_WITH_CLOUD_DOC,n.logEvent$1(this.props.currentSession,"select_legacy_action",t)}null===(o=(t=this.props).onExtensionClick)||void 0===o||o.call(t,e)},this.wrapperForAction=e=>({appAction:e,handler:this.createAppActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description}),this.renderActionRow=e=>{const t=e.icon;let o;o=t.is_static?i.genericAppIcon:t.url;const s=e.description,r=this.props.isInActionBar?i.toActionBarValue(this.wrapperForAction(e)):this.wrapperForAction(e);return R.default.createElement(n.Menu.ActionItem,{key:e.id,value:r,withLeftAccessory:R.default.createElement("img",{alt:"",src:o,width:24,height:24})},s)},this.renderUnpromotedActions=(e,t)=>{const{user:s,file:r,categoryIdToInfos:c,featureFlags:l,currentSession:p,telemetryContext:u,isInActionBar:d}=this.props,_=e.length>0,m={handler:()=>{const a=[...e,...t];i.showExtensionsMiniDirectoryModal(o.intl.formatMessage({id:"KVD2SP",defaultMessage:"Open or edit with these apps"}),s,r,a,c,l,u,p,void 0,this.props.isOfficeOnlineDecoupledFromCloudDocs),n.logEvent$1(p,_?"select_show_more":"select_add_app",{surface:u&&u.surface,userAction:_?n.OpenInUserAction.OpenMoreApps:n.OpenInUserAction.OpenAddApps})}},f=d?i.toActionBarValue(m):m;return R.default.createElement(n.Menu.ActionItem,{key:o.intl.formatMessage({id:"R/67N/",defaultMessage:"Show more"}),value:f,withLeftAccessory:_&&!d?null:R.default.createElement(n.UIIcon,{src:a.AddCircleLine})},_?o.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}):o.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}))}}render(){const{appActions:e,openOptions:t,bylines:o,currentSession:s,isInActionBar:r}=this.props,c=n.getOpenOptionsWithLogging(t,s),{unityOptions:a,cloudEditorOptions:p,previewOption:u,openInReplayOption:d,openInDesktopOption:_,goToFolderOption:m,openInNewTabOption:f,openInQuickViewOption:A,installDropboxAppOption:h,manageAsAdminOption:O}=n.partitionOptions(c),{cloudEditors:I,installedActions:g,unpromotedActions:y}=n.partitionActions(e),E=g.length>0,w=y.length>0,x=e=>r?i.toActionBarValue(e):e;return R.default.createElement(R.default.Fragment,null,h&&R.default.createElement(n.Menu.Segment,{withLabel:h.withLabel},R.default.createElement(n.Menu.ActionItem,{key:h.text,value:x(h),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.DownloadLine})},h.text)),R.default.createElement(K,{isInActionBar:r,unityOptions:a,legacyCloudEditorOptions:p,cloudEditorAppActions:I.map((e=>this.wrapperForAction(e))),bylines:o,currentSession:s,previewOption:u,openInReplayOption:d,openInNewTabOption:f,openInDesktopOption:_,goToFolderOption:m,openInQuickViewOption:A,wrapValuesForActionBar:!!r}),O&&R.default.createElement(n.Menu.Segment,null,R.default.createElement(n.Menu.ActionItem,{key:O.text,value:x(O),withLeftAccessory:R.default.createElement(n.UIIcon,{src:l.AdminConsoleLine})},O.text)),r&&(E||w)&&R.default.createElement(n.Menu.Segment,null,g.map((e=>this.renderActionRow(e))),this.renderUnpromotedActions(g,y)),!r&&E&&R.default.createElement(n.Menu.Segment,{key:"installed-actions"},g.map((e=>this.renderActionRow(e)))),!r&&w&&R.default.createElement(n.Menu.Segment,null,this.renderUnpromotedActions(g,y)))}}Q.displayName="BrowseFilePopoverContentComponent";const $=n.requireCssWithComponent(Q,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]);class j extends R.default.Component{constructor(e){super(e),this.createActionClickHandler=e=>()=>{if("cloud_editor"===e.handler[".tag"]){const t=e.handler.editor_name;if(this.props.isOfficeOnlineDecoupledFromCloudDocs&&p.isOfficeOnlineEditor(t))return p.openWithOfficeOnline(this.props.file.file_id,t,"shared_file_popover_content"),void n.logEvent$1(this.props.currentSession,"select_legacy_action",{type:n.OpenButtonAction.OPEN_WITH});const o=i.isWopiAction(e)?n.OpenButtonAction.OPEN_WITH:n.OpenButtonAction.OPEN_WITH_CLOUD_DOC;n.logEvent$1(this.props.currentSession,"select_legacy_action",{type:o});const s=n.UserActionSourceType.WEB_PREVIEW,r=i.cloudEditorNameToParams(t);p.openWithCloudEditor(p.fileToOpenWithParams(this.props.file),this.props.user,r,!1,s)}}}render(){if(0===this.props.openOptions.length&&0===this.props.cloudEditorAppActions.length)return null;const e=this.props.cloudEditorAppActions.map((e=>({appAction:e,handler:this.createActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description})));return R.default.createElement(K,{unityOptions:[],legacyCloudEditorOptions:this.props.openOptions,cloudEditorAppActions:e,bylines:{},wrapValuesForActionBar:!!this.props.isInActionBar})}}j.displayName="SharedFilePopoverContentComponent";const z=n.requireCssWithComponent(j,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]),G=e=>{const{file:t,user:o,telemetryContext:s,extraOptions:r,isInActionBar:c,previewActionHandler:a,openDesktopActionHandler:l,goToFolderActionHandler:p,replayActionHandler:u,openInNewTabActionHandler:d,quickViewActionHandler:_,onExtensionClick:m,installDropboxAppActionHandler:f,manageAsAdminActionHandler:A}=e,h=n.useAppActions().data,O=n.getOpenActionsForFile(h.actions,t),I=n.parseActionsForUserResult(h),g=I.bylines,y=h.category_infos,E=I.featureFlags,w="ON"===n.useExperimentVariant("decoupled_open_with_office_online").variant,x=n.useUnity(t,o),v=i.getCategoryIdToInfos(y),C=i.getOpenOptionsForFile({file:t,unityInfo:x,extraOptions:r,user:o,isInActionBar:c,previewActionHandler:a,openDesktopActionHandler:l,goToFolderActionHandler:p,replayActionHandler:u,openInNewTabActionHandler:d,quickViewActionHandler:_,installDropboxAppActionHandler:f,manageAsAdminActionHandler:A}),S=s&&(e.currentSession||n.createTelemetryClient({component:"menu_v2"}).session({surface:s.surface,ext:n.getPiiSafeExtension(n.getFileExt(t)||""),feature_flags:E}));if(n.isBrowseFile(t)&&O&&(O.length>0||C.length>0))return R.default.createElement($,{file:t,user:o,openOptions:C,appActions:O,bylines:g,categoryIdToInfos:v,featureFlags:E,telemetryContext:s,currentSession:S,isInActionBar:c,onExtensionClick:m,isOfficeOnlineDecoupledFromCloudDocs:w});if(n.isSharedFile(t)){const{cloudEditors:e}=n.partitionActions(O||[]);return R.default.createElement(z,{openOptions:C,cloudEditorAppActions:e,file:t,user:o,currentSession:S,isInActionBar:c,isOfficeOnlineDecoupledFromCloudDocs:w})}return null};G.displayName="ExtensionsPopoverContent";const X=new Set([".pptx",".docx",".xlsx",".ppt",".doc",".xls"]),Y="open_in_install_desktop_app",J="previews",Z="preview_toolbar",ee=()=>{window.open("https://www.dropbox.com/downloading?_tk=open_in_explorer_install_dc","_blank")},te={[n.OpenInUserAction.OpenInUnityFolder]:"desktop_folder",[n.OpenInUserAction.OpenInUnity]:"desktop_preview",[n.OpenInUserAction.OpenInReplay]:"replay_preview",[n.OpenInUserAction.PreviewFile]:"web_preview",[n.OpenInUserAction.OpenInDesktop]:"desktop_file",[n.OpenInUserAction.OpenMoreApps]:"connect_more_apps",[n.OpenInUserAction.OpenAddApps]:"connect_apps",[n.OpenInUserAction.OpenInOfficeOnline]:"office_online",[n.OpenInUserAction.InstallDropboxApp]:"downloading_page"},ne={surface:"previews"},ie=({actionContext:e,file:t,user:i,surface:o})=>{const{logUserAction:s,loggingSessionId:r}=n.useFileViewerContext(),c=n.useReplayActionHandler(t),{variant:a}=n.useExperimentVariant("open_in_explorer_install_dc"),l=((e,t,i,o)=>{if(!t||t===n.Variant.OFF)return!1;const s=`.${n.getExtension(e)}`,r=X.has(s),c=o!==n.SDKPreviewSurface.QUICK_VIEW_BROWSE&&o!==n.SDKPreviewSurface.QUICK_VIEW_SEARCH;return r&&!(e instanceof n.FileSharedWithMe)&&n.isLiveFile(e)&&n.isBrowseFile(e)&&!n.isEncryptedFile(e)&&c})(t,a,0,o);n.useLogExposureOnce("open_in_explorer_install_dc",!l);const p=((e,t)=>{if(t===n.Variant.V1&&e)return ee})(l,a);R.default.useEffect((()=>{p&&(e=>{const t=n.getExtension(e),i=t.startsWith(".")?t.slice(1):t,o=n.getFileTypeFromString(i);n.UDCL.logEvent({class:"navigation",action:"shown",object:"content_action_upsell",properties:{contentAction:Y,actionSurface:J,actionElement:Z,fileType:o,upsellVariant:"v1"}},{tags:{content_action:Y,action_surface:J,action_element:Z,...o&&{file_type:o},upsell_variant:"v1"}})})(t)}),[p,t]);const u=R.default.useMemo((()=>({sessionId:r,event:(t,i)=>{var r;if("show_byline"===t)return;const c="string"==typeof(null==i?void 0:i.userAction)?i.userAction:"",a=null!==(r=te[c])&&void 0!==r?r:"third_party_app";let l="previews";o===n.SDKPreviewSurface.QUICK_VIEW_BROWSE?l="browse_quick_view":o===n.SDKPreviewSurface.QUICK_VIEW_SEARCH&&(l="search_quick_view"),s(n.UserAction.OpenIn,e,{...i,destination_surface:a,actionSurface:l})}})),[e,s,r,o]);return R.default.createElement(G,{key:"open-in-action-btn",file:t,user:i,isInActionBar:!0,openDesktopActionHandler:n.makeOpenInDesktopHandler(t,i),replayActionHandler:c,installDropboxAppActionHandler:p,currentSession:u,telemetryContext:ne})};ie.displayName="OpenInMenuContent";const oe=n.withActionCondition(n.openInActionConditions,((e,t)=>t?{icon:n.OpenLine,label:n.OPEN_IN_ACTION_STRING,disabled:{disabled:!1},userAction:n.UserAction.OpenIn,action:{type:"menu",menu:R.default.createElement(ie,{user:e.user,file:e.file,actionContext:n.UserActionContext.FileMenu})}}:void 0),void 0);e.OpenInMenuContent=ie,e.makeOpenInAction=oe}));
//# sourceMappingURL=c_action_plugins_open_in_action_dropdown.js-vflWG_ZGh.map

//# debugId=8d818073-aebc-3ecb-984f-836c6fe95ddf