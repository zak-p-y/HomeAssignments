!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="bb8278b8-1333-30f9-9fab-6b8752cae3c0")}catch(e){}}();
define(["require","exports","./c_spectrum_util_raf_throttle","./c_react-use_misc_util","./c_bem","./e_file_viewer_static_scl_page_file","./c_api_v2_unauthed_client","./c_api_v2_routes_growth_provider","./c_pap-events_navigation_select_create_folder_action","./c_memoize-one","./c_core_i18n","./e_core_exception","./c_src_sink_index"],(function(e,t,o,i,r,n,c,s,a,d,u,l,_){"use strict";function f(e,t){const o=i.GetCloudDocsRoutes(new n.DefaultUserApiV2Client(e));let r;t.hasOwnProperty("docPathOrId")&&t.docPathOrId&&(r={".tag":"path_or_id",path_or_id:t.docPathOrId});const c=t.data&&t.data.webOpenId,s=t.data&&t.data.origDest,a=t.data&&t.data.routingDest;return o.rpc("log_user_action",{action:t.actionEvent,doc_id:r,source:t.actionSource,open_id:c,orig_dest:s,routing_dest:a,extra_info:t.extra},{})}function p(e){let t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=n.file_extension(e.filename),t&&(t="."+t)):(t=n.file_extension(e),t&&(t="."+t)),t}let E;const h=[{id:"word",icon:"word",name:u.intl.formatMessage({id:"HAvNZw",defaultMessage:"Word for the web"}),exts:["odt","docm","docx"],sizeLimitBytes:104857600,editor:n.MicrosoftEditors.WORD},{id:"excel",icon:"excel",name:u.intl.formatMessage({id:"zaRK6L",defaultMessage:"Excel for the web"}),exts:["ods","xlsb","xlsm","xlsx"],sizeLimitBytes:104857600,editor:n.MicrosoftEditors.EXCEL},{id:"powerpoint",icon:"powerpoint",name:u.intl.formatMessage({id:"rvFsee",defaultMessage:"PowerPoint for the web"}),exts:["odp","ppsx","pptx"],sizeLimitBytes:536870912,editor:n.MicrosoftEditors.POWERPOINT}];(class{static initClass(){this.PRELOAD_URLS={},E=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"]}static is_adobe_app(e){return Array.from(E).includes(e)}static getWopiOpenWithButtonInfo(e){if(n.isEncryptedFile(e))return null;let t;t=e.fq_path?e.fq_path:e.filename?e.filename:"";const o=n.file_extension(t);for(const e of h)if(-1!==e.exts.indexOf(o))return e;return null}}).initClass();class m{constructor(e){this.category="wopi-office_online_user_events",this.origin="web",this.user_id=e.userId,this.team_id=e.teamId,this.event_name=e.eventName,this.file_id=e.fileId,this.cloud_editor=e.cloudEditor,this.error=e.error,this.non_pii_extra=e.nonPiiExtra||{},Object.seal(this)}}const w=new d.URI({scheme:"https",authority:o.getDomains().WEBSERVER,path:"/office_online/open",query:{source:"open_with"}});var g;!function(e){e.WORD="word",e.EXCEL="excel",e.POWERPOINT="powerpoint"}(g||(g={}));const O=(e,t,o,i)=>{(new n.HiveLogger).log(new m({userId:s.mustGetActiveUserId(),teamId:s.getActiveTeamId(),eventName:e,fileId:t,cloudEditor:o,nonPiiExtra:i}))},y=()=>n.open_tab(n.LOADING_PAGE_URL,!0);const x=async(t,o)=>{const r=await async function(t){const{DefaultUserApiV2Client:o}=await new Promise((function(t,o){e(["./e_file_viewer_static_scl_page_file"],t,o)})).then((function(e){return e.default_user_client_esnext}));return i.GetCloudDocsRoutes(new o(t))}(t);return r.rpc("get_cloud_editor_url",{file_id:o},{})};function W(e){!function(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])e.error[".tag"]}(e)}function A(e,t,o,i,r,c,s){const a=l.generateUUID("web_open_id"),u=d.URI.parse(e.cloud_editor_url).updateQuery({cloud_editor:r,web_open_id:a});c&&u.updateQuery({ignore_lock:"1"});const _=u.toString();_&&(void 0===s&&(s=n.UserActionSourceType.WEB),f(i,{actionEvent:n.UserActionEventType.PRE_OPEN,docPathOrId:o,actionSource:s,data:{webOpenId:a}}),null!=t?n.redirect(_,t):n.open_tab(_))}var I;!function(e){e.OfficeOnline="OfficeOnline"}(I||(I={})),t.createPlaceholderTabForNewCloudDoc=y,t.fileToOpenWithParams=e=>({fileId:e.file_id,openToUrl:e.open_to_url}),t.getActionSourceFromNewFileMenuType=e=>{switch(e){case n.NewFileMenuFromType.BROWSE:return n.UserActionSourceType.WEB_BROWSE;case n.NewFileMenuFromType.HOME:return n.UserActionSourceType.WEB_HOME;default:return n.UserActionSourceType.WEB}},t.getActionSourceFromSurface=e=>"search"===e?n.UserActionSourceType.WEB_SEARCH:"previews"===e?n.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?n.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?n.UserActionSourceType.WEB_BROWSE:n.UserActionSourceType.WEB,t.isCloudBasedDoc=function(e){return!!function(e){return[".gdoc",".gsheet",".gslides"].indexOf(p(e))>=0}(e)||!!function(e){return".web"===p(e)}(e)},t.isOfficeOnlineEditor=e=>e===g.WORD||e===g.EXCEL||e===g.POWERPOINT,t.logUserAction=f,t.openWithCloudEditor=async({fileId:e,openToUrl:t},i,c,s,a)=>{try{const d=performance.now(),u=_.getMetricsReporter(),l={};try{l.editor=c,a&&(l.source=a[".tag"]);const n=(()=>{let e=!1;if(r.edge||r.msie||r.edgeChromium())try{e=window.self!==window.top}catch(t){e=!0}return e})();if(l.isInEdgeIframe=String(n),t&&t.startsWith(`https://${o.getDomains().WEBSERVER}/scl/fi/`)){l.usedOpenToURLFromFile="true";A({cloud_editor_url:t},null,e,i,c,s,a)}else{l.usedOpenToURLFromFile="false";const t=n?null:y();A(await x(i,e),t,e,i,c,s,a)}l.error="false"}catch(e){l.error="true",W(e)}finally{u.createStats({ns:n.CLOUD_DOCS_AMP_NAMESPACE,name:"web/openWithCloudEditor"},l).recordDuration(performance.now()-d,r.TimeUnit.MILLISECONDS)}}catch(e){W(e)}},t.openWithOfficeOnline=(e,t,o)=>{const i=w.clone();i.updateQuery({file_id:e,cloud_editor:t,surface:o||""});const r=window.location;r.pathname.startsWith("/scl/fi")&&i.updateQuery({scl_origin:r.href}),n.UDCL.logEvent("office_online/open_with_click",{tags:{editor:t,surface:o||""}}),O("user_opened_with_office_online",e,t,{surface:o||""}),n.unsafe_open_tab(i)}}));
//# sourceMappingURL=c_cloud_docs_open_with_utils.js-vfl-TPg5w.map

//# debugId=bb8278b8-1333-30f9-9fab-6b8752cae3c0